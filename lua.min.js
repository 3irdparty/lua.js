(function(){function D(d){return z[/\.\/(\w*)\.js/.exec(d)[1]]}var z={lex:{},parser:{},codegen:{},types:{},index:{}};(function(d){function c(c){return e.test(c)}function v(e){return"\n"==e||"\r"==e}function g(e,c,g){var k=0,h=e();if("["!=h&&"]"!=h)throw"Lexical internal error!";g&&g(h);for(c();"="==e();)c(),g&&g(e()),++k;return e()==h?k:-k-1}function h(e,c){var g=e();c();v(e())&&e()!=g&&c()}function k(e,c,k){function d(e){m.push(e)}var m=[];c();for(v(e())&&h(e,c);;){var l=e();switch(l){case null:throw"unfinished long string/comment";
case "]":if(g(e,c,d)==k)return c(),m.splice(-k-1,k+1),m.join("");break;case "\n":case "\r":h(e,c);d("\n");break;default:d(l),c()}}}function l(e,u){for(;;)switch(e()){case "\n":case "\r":case " ":case "\f":case "\t":case "\v":u();break;case "-":u();if("-"!=e())return"-";u();var d=e();if("["==d){var l=g(e,u);if(0<=l){k(e,u,l);break}}for(;d&&"\n"!=d&&"\r"!=d;)u(),d=e();break;case "[":l=g(e,u);if(0<=l)return{id:w.TK_STRING,val:k(e,u,l)};if(-1==l)return"[";throw"invalid long string delimiter";case "=":u();
if("="!=e())return"=";u();return w.TK_EQ;case "<":u();if("="!=e())return"<";u();return w.TK_LE;case ">":u();if("="!=e())return">";u();return w.TK_GE;case "~":u();if("="!=e())return"~";u();return w.TK_NE;case ":":u();if(":"!=e())return":";u(ls);return w.TK_DBCOLON;case '"':case "'":var d=w.TK_STRING,l=e,n=u,x=[],A=l();n();for(var v=void 0;(v=l())!=A;)switch(v){case null:throw"unfinished string";case "\n":case "\r":throw"unfinished string";case "\\":n();v=l();switch(v){case "b":x.push("\b");n();break;
case "f":x.push("\f");n();break;case "n":x.push("\n");n();break;case "r":x.push("\r");n();break;case "t":x.push("\t");n();break;case "v":x.push("\v");n();break;case "\n":case "\r":x.push("\n");h();break;case "\\":case '"':case "'":x.push(v);n();break;case null:throw"unfinished string";case "z":for(n();lisspace(l());)n();break;case "x":throw"esacpe for char code not supported in lua.js yet.";default:if(!m.test(v))throw"invalid escape sequence"+v;throw"esacpe for char code not supported in lua.js yet.";
}break;default:x.push(v),n()}n();l=x.join("");return{id:d,val:l};case ".":u();if("."==e())return u(),"."==e()?(u(),w.TK_DOTS):w.TK_CONCAT;d=e();if(!m.test(d))return".";case "0":case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":d=w.TK_NUMBER;l=e;n=u;x=l();n();if("0"!=x||"x"!=l()&&"X"!=l()){x=[x];for(A=l();m.test(A)||"."==A;)x.push(A),n(),A=l();l=parseFloat(x.join(""))}else throw n(),Error("Hexadecimal numeric not supported in lua.js yet.");return{id:d,val:l};case null:return w.TK_EOS;
default:d=e();if(B.test(d)){d=e;l=u;for(n=[];c(d());)n.push(d()),l();d=n.join("");return(l=q[d])?l:{id:w.TK_NAME,val:d}}d=e();u();return d}}function n(e){function c(){return d<e.length?e.charAt(d):null}function g(){d<e.length&&++d}var d=0;return function(){return l(c,g)}}d.tokens="<eof> and break do else elseif end false for function goto if in local nil not or repeat return then true until while .. ... == >= <= ~= :: <--orgion-eof> <number> <name> <string> __javascript __jsreturn".split(" ");var q=
{and:1,"break":2,"do":3,"else":4,elseif:5,end:6,"false":7,"for":8,"function":9,"goto":10,"if":11,"in":12,local:13,nil:14,not:15,or:16,repeat:17,"return":18,then:19,"true":20,until:21,"while":22,__javascript:34,__js:34,__jsreturn:35},w={TK_EOS:0,TK_AND:1,TK_BREAK:2,TK_DO:3,TK_ELSE:4,TK_ELSEIF:5,TK_END:6,TK_FALSE:7,TK_FOR:8,TK_FUNCTION:9,TK_GOTO:10,TK_IF:11,TK_IN:12,TK_LOCAL:13,TK_NIL:14,TK_NOT:15,TK_OR:16,TK_REPEAT:17,TK_RETURN:18,TK_THEN:19,TK_TRUE:20,TK_UNTIL:21,TK_WHILE:22,TK_CONCAT:23,TK_DOTS:24,
TK_EQ:25,TK_GE:26,TK_LE:27,TK_NE:28,TK_DBCOLON:29,TK_NUMBER:31,TK_NAME:32,TK_STRING:33,TK_JAVASCRIPT:34,TK_JSRETURN:35};d.TK=w;var B=/^[A-Za-z\_]$/,m=/^[0-9]$/,e=/^[0-9A-Za-z\_]$/;d.generator=n;d.lex=function(e){var c=n(e),g=c(),d=c();return{curr:function(){return g},lookAhead:function(){return d},next:function(){g=d;d=c()}}}})(z.lex);(function(d){function c(e){switch(typeof e){case "string":case "number":return e;case "object":return e.id}}function v(e){return"number"==typeof e?F[e]:"object"==typeof e?
F[e.id]:e}function g(e){k(e,r.TK_NAME);var c=e.curr().val;e.next();return{type:"variable",val:c}}function h(e,g){if(c(e.curr())==g)return e.next(),!0}function k(e,g){if(c(e.curr())!=g)throw Error("symbol "+v(g)+" expected!");}function l(e,c){k(e,c);e.next()}function n(e){k(e,r.TK_NAME);var c=e.curr().val;e.next();return c}function q(e){return{type:"const.string",val:n(e)}}function w(e){k(e,r.TK_STRING);var c=e.curr().val;e.next();return{type:"const.string",val:c}}function B(e){e.next();var c=y(e,
0);l(e,"]");return c}function m(e){switch(c(e.curr())){case "(":e.next();if(")"==e.curr())return e.next(),[];var g=E(e);l(e,")");return g;case "{":return[x(e)];case r.TK_STRING:return[w(e)];default:throw Error("function arguments expected, got "+v(e.curr()));}}function e(e){var p;a:switch(p=c(e.curr()),p){case "(":e.next();p=y(e,0);l(e,")");p={type:"expr.brackets",expr:p};break a;case r.TK_NAME:p=g(e);break a;case r.TK_JAVASCRIPT:e.next();p={type:"expr.javascript",args:m(e)};break a;default:throw Error("unexpected symbol "+
(F[p]||p));}for(;;)switch(c(e.curr())){case ".":e.next();var d=q(e);p={type:"expr.index",self:p,key:d};break;case "[":d=B(e);p={type:"expr.index",self:p,key:d};break;case ":":e.next();var d=q(e),u=m(e);p={type:"expr.callMethod",self:p,key:d,args:u};break;case "(":case "{":case r.TK_STRING:u=m(e);p={type:"expr.call",func:p,args:u};break;default:return p}}function p(e){switch(e.curr()){case "+":return 1;case "-":return 2;case "*":return 3;case "/":return 4;case "%":return 5;case "^":return 6;case r.TK_CONCAT:return 7;
case r.TK_EQ:return 8;case "<":return 9;case r.TK_LE:return 10;case r.TK_NE:return 11;case ">":return 12;case r.TK_GE:return 13;case r.TK_AND:return 14;case r.TK_OR:return 15}}function u(g){switch(c(g.curr())){case r.TK_NUMBER:var p=g.curr().val;g.next();return{type:"const.number",val:p};case r.TK_STRING:return w(g);case r.TK_NIL:return g.next(),{type:"const.nil"};case r.TK_TRUE:return g.next(),{type:"const.boolean",val:!0};case r.TK_FALSE:return g.next(),{type:"const.boolean",val:!1};case r.TK_DOTS:return g.next(),
{type:"vararg"};case "{":return x(g);case r.TK_FUNCTION:return g.next(),z(g);default:return e(g)}}function y(e,c){var g,d;a:{switch(e.curr()){case r.TK_NOT:d="uop.not";break a;case "-":d="uop.minus";break a;case "#":d="uop.len";break a}d=void 0}d?(e.next(),g=y(e,M),g={type:"expr.uop",op:d,operand:g}):g=u(e);for(d=p(e);d&&J[d][0]>c;){e.next();var k=y(e,J[d][1]);g={type:"expr.op",op:K[d],left:g,right:k};d=p(e)}return g}function E(e){var c=[];for(c.push(y(e,0));h(e,",");)c.push(y(e,0));return c}function H(e){var g;
g=c(e.curr())==r.TK_NAME?q(e):B(e);l(e,"=");return{type:"field.rec",key:g,val:y(e,0)}}function x(e){l(e,"{");var g=[];do{if("}"==e.curr())break;var p;a:{p=e;var d=p.curr();switch(c(d)){case r.TK_NAME:p="="!=p.lookAhead()?{type:"field.list",val:y(p,0)}:H(p);break a;case "[":p=H(p);break a;default:p={type:"field.list",val:y(p,0)}}}p&&g.push(p)}while(h(e,",")||h(e,";"));l(e,"}");return{type:"expr.constructor",fields:g}}function A(e,c){var g={type:c?"stat.jsreturn":"stat.return",nret:[]};e.next();L(e)||
";"==e.curr()||(g.nret=E(e));for(;h(e,";"););return g}function I(c){switch(c.curr()){case ";":c.next();break;case r.TK_IF:var p={type:"stat.if"},d=p;c.next();var u=d;u.cond=y(c,0);l(c,r.TK_THEN);for(u.tblock=C(c);h(c,r.TK_ELSEIF);){d.fblock={type:"block",stats:[{type:"stat.if"}]};var d=d.fblock.stats[0],u=c,k=d;k.cond=y(u,0);l(u,r.TK_THEN);k.tblock=C(u)}h(c,r.TK_ELSE)&&(d.fblock=C(c));l(c,r.TK_END);return p;case r.TK_WHILE:return c.next(),p=y(c,0),l(c,r.TK_DO),d=C(c),l(c,r.TK_END),{type:"stat.while",
cond:p,block:d};case r.TK_DO:return c.next(),p=C(c),l(c,r.TK_END),p;case r.TK_FOR:c.next();d=n(c);switch(c.curr()){case "=":c.next();u=y(c,0);l(c,",");k=y(c,0);h(c,",")&&(p=y(c,0));p={type:"stat.fornum",varname:d,from:u,to:k,step:p};break;case ",":case r.TK_IN:for(p=[d];h(c,",");)p.push(n(c));l(c,r.TK_IN);p={type:"stat.forlist",varnames:p,explist:E(c)};break;default:throw"`=` or `in` expected";}l(c,r.TK_DO);p.block=C(c);l(c,r.TK_END);return p;case r.TK_REPEAT:return c.next(),p=C(c),l(c,r.TK_UNTIL),
{type:"stat.repeat",until:y(c,0),block:p};case r.TK_FUNCTION:c.next();for(p=g(c);h(c,".");)d=q(c),p={type:"expr.index",self:p,key:d};h(c,":")?(d=q(c),p={type:"stat.method",self:p,key:d}):p={type:"stat.function",left:p};p.func=z(c);return p;case r.TK_LOCAL:c.next();if(h(c,r.TK_FUNCTION))return{type:"stat.localfunction",name:n(c),func:z(c)};p=[];do p.push(n(c));while(h(c,","));h(c,"=")&&(d=E(c));return{type:"stat.local",names:p,right:d};case r.TK_RETURN:return A(c);case r.TK_JSRETURN:return A(c,!0);
case r.TK_BREAK:return c.next(),{type:"stat.break"};default:p=e(c);if("="==c.curr()||","==c.curr()){for(p=[p];h(c,",");)p.push(e(c));l(c,"=");c={type:"stat.assignment",lefts:p,right:E(c)}}else{if("expr.call"!=p.type&&"expr.callMethod"!=p.type&&"expr.javascript"!=p.type)throw Error("syntax error, unexpected expr type "+p.type);c={type:"stat.expr",expr:p}}return c}}function L(e){switch(e.curr()){case r.TK_ELSE:case r.TK_ELSEIF:case r.TK_END:case r.TK_EOS:case r.TK_UNTIL:return!0;default:return 0}}function C(e){for(var c=
[];!L(e);){if(e.curr()==r.TK_RETURN||e.curr()==r.TK_JSRETURN){c.push(I(e));break}var p=I(e);p&&c.push(p)}return{type:"block",stats:c}}function z(e){l(e,"(");var p=[];if(")"!=e.curr()){do switch(c(e.curr())){case r.TK_NAME:p.push(n(e));break;case r.TK_DOTS:p.push(r.TK_DOTS);e.next();break;default:throw"<name> or `...` expected";}while(h(e,","))}var g=!1;0<p.length&&p[p.length-1]==r.TK_DOTS&&(p.pop(),g=!0);l(e,")");var d=C(e);l(e,r.TK_END);return{type:"function",args:p,varargs:g,block:d}}var G=D("./lex.js"),
N=G.lex,r=G.TK,F=G.tokens,J=[null,[6,6],[6,6],[7,7],[7,7],[7,7],[10,9],[5,4],[3,3],[3,3],[3,3],[3,3],[3,3],[3,3],[2,2],[1,1]],K=[null,"op.add","op.minus","op.mul","op.div","op.mod","op.pow","op.concat","op.equal","op.less","op.lessequal","op.notequal","op.great","op.greatequal","op.and","op.or"];d.opname=K;var M=8;d.main=function(e){var c={type:"function",args:[],varargs:!0,block:C(e)};k(e,r.TK_EOS);return c};d.parse=function(e){return d.main(N(e))}})(z.parser);(function(d){function c(e){return"const.number"==
e.type?k(e):"l.__checknumber("+g(e)+")"}function v(e){if("vararg"==e.type||"expr.call"==e.type||"expr.callMethod"==e.type)return!0}function g(e){return v(e)?"("+k(e)+")[0]":k(e)}function h(e){if(e.length&&v(e[e.length-1])){if(1==e.length)return k(e[0]);for(var c=[],d=0;d<e.length-1;d++)c.push(g(e[d]));return"["+c.join(",")+"].concat("+k(e[e.length-1])+")"}c=[];for(d=0;d<e.length;d++)c.push(g(e[d]));return"["+c.join(",")+"]"}function k(e){if(n[e.type])return n[e.type](e);throw Error("Unsupported ast type "+
e.type);}function l(e,c){return function(g){function d(g,u){if(g&&g.constructor==Array){for(var k=0;k<g.length;k++)g[k]=d(g[k],u);return g}if(g&&g.type){var h=e(g,u)||g,l=m[h.type];if(l)for(k=0;k<l.length;k++)h[l[k]]=d(h[l[k]],h);c&&(h=c(h,u)||h);return h}}return d(g)}}var n={},q,w,B;q="\n";w=function(){q+="    "};B=function(){q=q.substr(0,q.length-4)};n["function"]=function(e){return"l._f(function("+e.args.join(",")+")"+k(e.block)+")"};n.block=function(e){var c=[];w();for(var g=0;g<e.stats.length;g++)c.push(k(e.stats[g]));
B();return q+"{"+c.join("")+q+"}"};n["stat.getvaargs"]=function(e){return q+"var __VA_ARG = Array.prototype.slice.call(arguments, "+e.argCount+");"};n["stat.expr"]=function(e){return q+k(e.expr)+";"};n["stat.local"]=function(e){if(e.right){if(1==e.names.length)return q+"var "+e.names[0]+" = "+g(e.right[0])+";";for(var c=[],d=0;d<e.names.length;d++)c.push(e.names[d]+" = t["+d+"]");return q+"var t ="+h(e.right)+","+q+c.join(",")+";"}return q+"var "+e.names.join(",")+";"};n["stat.if"]=function(e){var c=
q+"if ("+g(e.cond)+")"+k(e.tblock);return e.fblock&&0<e.fblock.stats.length?1==e.fblock.stats.length&&"stat.if"==e.fblock.stats[0].type?c+"else"+k(e.fblock.stats[0]):c+"else"+k(e.fblock):c};n["stat.fornum"]=function(e){if(e.step){w();var g=q+e.varname+" = "+e.$var+";"+k(e.block)+q+e.$var+" += "+e.$step;B();return q+"var "+e.$var+" = "+c(e.from)+", "+e.$limit+" = "+c(e.to)+", "+e.$step+" = "+c(e.step)+","+e.varname+";"+q+"while (("+e.$step+">0 && "+e.$var+"<="+e.$limit+") || ("+e.$step+"<0 && "+e.$var+
">="+e.$limit+")){"+g+q+"}"}return q+"for (var "+e.varname+", "+e.$var+" = "+c(e.from)+", "+e.$limit+" = "+c(e.to)+";("+e.varname+"="+e.$var+")<="+e.$limit+";++"+e.$var+")"+k(e.block)};n["stat.forlist"]=function(e){w();var c=e.$st,g=[];g.push(q+"var t = "+c+"[0]("+c+"[1],"+c+"[2]);");for(var d=0;d<e.varnames.length;++d)g.push(q+"var "+e.varnames[d]+" = t["+d+"];");g.push(q+"if ("+e.varnames[0]+" == null) break;");g.push(q+c+"[2] = "+e.varnames[0]+";");g.push(k(e.block));B();return q+"var "+c+" = "+
h(e.explist)+";"+q+"for (;;)"+q+"{"+g.join("")+q+"}"};n["stat.while"]=function(e){return q+"while ("+g(e.cond)+")"+k(e.block)};n["stat.repeat"]=function(e){return q+"do "+k(e.block)+"while (!("+g(e.until)+"));"};n["stat.break"]=function(e){return q+"break;"};n.vararg=function(e){return"__VA_ARG"};n["stat.return"]=function(e){var c=e.nret;if(c.length&&v(c[c.length-1]))return q+"return "+h(e.nret);for(var c=[],d=0;d<e.nret.length;d++)c.push(g(e.nret[d]));return q+"return ["+c+"];"};n["stat.jsreturn"]=
function(e){return q+"return "+g(e.nret)};n["stat.assignment"]=function(e){if(1==e.lefts.length){var c=1==e.right.length?g(e.right[0]):h(e.right)+"[0]";if("expr.index"==e.lefts[0].type){var d=e.lefts[0];return q+"l.__set("+g(d.self)+", "+k(d.key)+", "+c+");"}return q+k(e.lefts[0])+" = "+c+";"}c=[];c.push(q+"var t = "+h(e.right)+";");for(var l=0;l<e.lefts.length;++l)"expr.index"==e.lefts[l].type?(d=e.lefts[l],c.push(q+"l.__set("+g(d.self)+","+k(d.key)+",t["+l+"]);")):c.push(q+k(e.lefts[l])+" = t["+
l+"];");return c.join("")};n["expr.index"]=function(e){return"l.__get("+g(e.self)+","+k(e.key)+")"};n["expr.op"]=function(e){var c,d;switch(e.op){case "op.add":c="l.__add";break;case "op.minus":c="l.__sub";break;case "op.mul":c="l.__mul";break;case "op.div":c="l.__div";break;case "op.mod":c="l.__mod";break;case "op.pow":c="l.__pow";break;case "op.concat":c="l.__concat";break;case "op.equal":c="l.__eq";break;case "op.less":c="l.__lt";break;case "op.lessequal":c="l.__le";break;case "op.notequal":c=
"l.__neq";break;case "op.great":c="l.__gt";break;case "op.greatequal":c="l.__ge";break;case "op.and":d="&&";break;case "op.or":d="||";break;default:throw Error(e.op+" is not implemented yet.");}if(d)return g(e.left)+d+g(e.right);if(c)return c+"("+g(e.left)+","+g(e.right)+")"};n["expr.uop"]=function(e){switch(e.op){case "uop.minus":return"l.__unm("+g(e.operand)+")";case "uop.not":return"!("+g(e.operand)+")";case "uop.len":return"l.__len("+g(e.operand)+")";default:throw Error(e.op+" is not implemented yet.");
}};n["expr.call"]=function(e){return"l.__call("+g(e.func)+","+h(e.args)+")"};n["expr.callMethod"]=function(e){return"l.__callMethod("+g(e.self)+","+g(e.key)+","+h(e.args)+")"};n["expr.brackets"]=function(e){return v(e.expr)?g(e.expr):"("+k(e.expr)+")"};n["expr.constructor"]=function(e){if(!e.fields.length)return"l.__newTable()";for(var c=[],d=0;d<e.fields.length;d++){var h=e.fields[d];if("field.list"==h.type)v(h.val)&&d==e.fields.length-1?c.push("[2, "+k(h.val)+"]"):c.push("[0, "+g(h.val)+"]");else if("field.rec"==
h.type)c.push("[1, "+k(h.key)+","+g(h.val)+"]");else throw Error("Invalid field type "+h.type);}return"l.__newTable(["+c.join(",")+"])"};n.variable=function(e){return e.val};n["const.string"]=function(e){return e.val?JSON.stringify(e.val):"l.ds"};n["const.number"]=function(e){return e.val?JSON.stringify(e.val):"l.d0"};n["const.boolean"]=function(e){return JSON.stringify(e.val)};n["const.nil"]=function(e){return"null"};n["expr.javascript"]=function(e){if(1!=e.args.length)throw Error("__javascript should have exactly one arguments.");
return"const.string"==e.args[0].type?"("+e.args[0].val+")":"eval("+g(e.args[0])+")"};var m={"expr.uop":["operand"],"expr.op":["left","right"],"stat.assignment":["lefts","right"],"stat.expr":["expr"],"field.list":["val"],"field.rec":["key","val"],"expr.constructor":["fields","recs","list"],"stat.if":["cond","tblock","fblock"],"stat.fornum":["from","to","step","block"],"stat.forlist":["explist","block"],"stat.while":["cond","block"],"stat.repeat":["until","block"],"expr.index":["self","key"],"expr.callMethod":["self",
"key","args"],"expr.call":["func","args"],"expr.brackets":["expr"],"stat.method":["self","key","func"],"stat.function":["left","func"],"stat.localfunction":["func"],"stat.local":["right"],"stat.return":["nret"],"function":["block"],block:["stats"]};d.traverse=l;d.phases=[];d.postphases=[];d.run=function(e){for(var c=0;c<d.phases.length;c++)e=d.phases[c](e);e=k(e);for(c=0;c<d.postphases.length;c++)e=d.postphases[c](e);return e};(function(){d.phases.push(l(function(e){switch(e.type){case "function":e.varargs&&
e.block.stats.unshift({type:"stat.getvaargs",argCount:e.args.length});e=e.block.stats;0!=e.length&&"stat.return"==e[e.length-1].type||e.push({type:"stat.return",nret:[]});break;case "block":for(var c=[],g=0;g<e.stats.length;g++){var d=e.stats[g];switch(d.type){case "stat.localfunction":c.push({type:"stat.local",names:[d.name]});c.push({type:"stat.assignment",lefts:[{type:"variable",val:d.name}],right:[d.func]});break;case "stat.function":c.push({type:"stat.assignment",lefts:[d.left],right:[d.func]});
break;case "stat.method":d.func.args.unshift("self");c.push({type:"stat.assignment",lefts:[{type:"expr.index",self:d.self,key:d.key}],right:[d.func]});break;default:c.push(e.stats[g])}}e.stats=c}}))})();(function(){d.phases.push(function(e){var c=[],g,d={},k=0;return e=l(function(e){var h;switch(e.type){case "block":h=[];break;case "function":h=e.args;break;case "stat.fornum":h=[e.varname,"$var","$limit","$step"];break;case "stat.forlist":h=e.varnames;h.push("$st");break;case "variable":if(d[e.val]){var l;
h=d[e.val];"fornum"==g.curr.type||"forlist"==g.curr.type?h[h.length-1]!=g.curr?l=h[h.length-1]:1<h.length&&(l=h[h.length-2]):l=h[h.length-1];if(l){e.val=e.val+"$"+l.id;return}}return"_ENV"==e.val?void 0:{type:"expr.index",self:{type:"variable",val:"_ENV"},key:{type:"const.string",val:e.val}}}if(h){g&&c.push(g);g={curr:e,names:h.slice(0)};for(l=0;l<h.length;l++){var m=h[l];d[m]=d[m]||[];var n=++k;h[l]=m+"$"+n;d[m].push({id:n,curr:e})}"stat.fornum"==e.type?(e.varname=h[0],e.$var=h[1],e.$limit=h[2],
e.$step=h[3]):"stat.forlist"==e.type&&(e.$st=h.pop())}},function(e){if(g&&g.curr==e){for(var h=0;h<g.names.length;h++){var l=g.names[h];d[l].pop();0==d[l].length&&delete d[l]}g=c.pop()}else if("stat.local"==e.type)for(h=0;h<e.names.length;h++){l=e.names[h];d[l]=d[l]||[];var m=d[l];if(0<m.length&&m[m.length-1]===g){var n=m[m.length-1].id=++k;e.names[h]=l+"$"+n}else n=++k,e.names[h]=l+"$"+n,m.push({id:n,curr:g.curr}),g.names.push(l)}})(e)})})();d.sign="/*lua.js generated code*/";(function(){d.postphases.push(function(e){return"/*lua.js generated code*/return "+
e+";"})})()})(z.codegen);(function(d){function c(c){this.stringMap={};this.array=[];this.hashMap={};this.metatable=null;this._hashKey=++h;if(c)for(var g=0;g<c.length;g++){var d=c[g];if(0==d[0])this.array.push(d[1]);else if(1==d[0])this.set(d[1],d[2]);else for(var q=0;q<d[1].length;q++)this.array.push(d[1][q])}}var v={_hashKey:-1,valueOf:function(){return 0},toString:function(){return"0"}},g={_hashKey:-2,toString:function(){return""}};d.dummy0=v;d.dummyStr=g;var h=0;d.LuaTable=c;d.newHashKey=function(){return++h};
c.prototype={};c.prototype.constructor=c;c.prototype.get=function(c){switch(typeof c){case "number":return this.array[c-1];case "string":return this.stringMap[c];case "object":if(c===v)return this.array[-1];if(c===g)return this.stringMap[c];if(null===c)throw Error("table index is nil");case "function":return c._hashKey||(c._hashKey=++h),(c=this.hashMap[c._hashKey])&&c[1];default:throw Error("get with a invalid argument"+c);}};c.prototype.set=function(c,g){if(null==c)throw Error("table index is nil");
if(null==g)switch(typeof c){case "number":c==this.array.length?this.array.pop():delete this.array[c-1];break;case "string":delete this.stringMap[c];break;case "object":case "function":if(!c._hashKey)break;delete this.hashMap[c._hashKey];break;default:throw Error("set with a invalid argument"+c);}else switch(typeof c){case "number":this.array[c-1]=g;break;case "string":this.stringMap[c]=g;break;case "object":case "function":c._hashKey||(c._hashKey=++h);this.hashMap[c._hashKey]=[c,g];break;default:throw Error("set with a invalid argument"+
c);}};c.prototype.length=function(){for(var c=this.array.length;0<c&&null==this.array[c-1];--c);c!=this.array.length&&(this.array.length=c);return this.array.length};c.prototype.toString=function(){return"table "+this._hashKey}})(z.types);(function(d){function c(c){return c.substr(0,k.length)!=k?h.run(g.parse(c)):c}function v(){function g(e,c){var d=m.__getmetatable(e);return d&&d.stringMap&&d.stringMap[c]}if(!(this instanceof v))return new v;var k=new l.LuaTable;this._G=k;k.set("_G",k);k.set("_VERSION",
"Lua 5.2");k.set("_LUAJS","Lua.js 0.1");var m={};m.d0=n;m.ds=q;m.__getmetatable=function(e){if(!e)return null;switch(typeof e){case "object":return e.metatable||(e instanceof l.LuaTable?null:m.jsObjMT);case "string":return m.stringMT;case "function":if(!f.__lua_function)return m.jsFuncMT;default:return null}};m._f=function(e){e.__lua_function=!0;return e};m.__get=function(e,c){var d;if(e instanceof l.LuaTable){if(d=e.get(c))return d;d=g(e,"__index");if(!d)return null}else{if("object"==typeof e||"function"==
typeof e&&!e.__lua_function){var h=e[c];if("function"==typeof h)return function(e){var c=Array.prototype.slice.call(arguments,1);return h.apply(e,c)};if(!h&&"new"==c){var k=function(){};k.prototype=e.prototype;return function(){var e=new k;t.apply(e,arguments);return e}}return h}d=g(e,"__index");if(!d)throw Error("attempt to index a "+m.__type(e)+" value.");}return"function"==typeof d?m.__call(d,[e,c])[0]:m.__get(d,c)};m.__set=function(e,c,d){var h;if(e instanceof l.LuaTable){if(e.get(c)){e.set(c,
d);return}h=g(e,"__newindex");if(!h){e.set(c,d);return}}else{if("object"==typeof e||"function"==typeof e&&!e.__lua_function){e[c]=d;return}h=g(e,"__newindex");if(!h)throw Error("attempt to index a "+m.__type(e)+" value.");}"function"==typeof h?m.__call(h,[e,c,d]):m.__set(h,c,d)};m.__add=function(e,c){if("number"==typeof e&&"number"==typeof c)return e+c||n;var d=m.__tonumber(e),h=m.__tonumber(c);if(d&&h)return e+c||n;if(d=g(e,"__add")||g(c,"__add"))return m.__call(d,[e,c])[0];throw Error("attempt to perform arithmetic on a "+
m.__type(e)+" value");};m.__sub=function(e,c){if("number"==typeof e&&"number"==typeof c)return e-c||n;var d=m.__tonumber(e),h=m.__tonumber(c);if(d&&h)return e-c||n;if(d=g(e,"__sub")||g(c,"__sub"))return m.__call(d,[e,c])[0];throw Error("attempt to perform arithmetic on a "+m.__type(e)+" value");};m.__mul=function(e,c){if("number"==typeof e&&"number"==typeof c)return e*c||n;var d=m.__tonumber(e),h=m.__tonumber(c);if(d&&h)return e*c||n;if(d=g(e,"__mul")||g(c,"__mul"))return m.__call(d,[e,c])[0];throw Error("attempt to perform arithmetic on a "+
m.__type(e)+" value");};m.__div=function(e,c){if("number"==typeof e&&"number"==typeof c)return e/c||n;var d=m.__tonumber(e),h=m.__tonumber(c);if(d&&h)return e/c||n;if(d=g(e,"__div")||g(c,"__div"))return m.__call(d,[e,c])[0];throw Error("attempt to perform arithmetic on a "+m.__type(e)+" value");};m.__mod=function(e,c){if("number"==typeof e&&"number"==typeof c)return e%c||n;var d=m.__tonumber(e),h=m.__tonumber(c);if(d&&h)return e%c||n;if(d=g(e,"__mod")||g(c,"__mod"))return m.__call(d,[e,c])[0];throw Error("attempt to perform arithmetic on a "+
m.__type(e)+" value");};m.__pow=function(e,c){if("number"==typeof e&&"number"==typeof c)return Math.pow(e,c)||n;var d=m.__tonumber(e),h=m.__tonumber(c);if(d&&h)return Math.pow(e,c)||n;if(d=g(e,"__pow")||g(c,"__pow"))return m.__call(d,[e,c])[0];throw Error("attempt to perform arithmetic on a "+m.__type(e)+" value");};m.__unm=function(e){var c=m.__tonumber(e);if(c)return-c;if(c=g(e).__unm)return m.__call(c,[e])[0];throw Error("attempt to perform arithmetic on a "+m.__type(e)+" value");};m.__eq=function(e,
c){return!m.__neq(e,c)};m.__neq=function(c,d){if(c===d)return!1;var h=m.__type(c),k=m.__type(d);if(h!=k||"table"!=h&&"userdata"!=h)return!0;h=g(c,"__eq");k=g(d,"__eq");return h&&h==k?!m.__call(h,[c,d])[0]:!0};m.__gt=function(c,g){return m.__lt(g,c)};m.__ge=function(c,g){return m.__le(g,c)};m.__lt=function(c,d){var h=m.__type(c),k=m.__type(d);if("number"==h&&"number"==k||"string"==h&&"string"==k)return c<d;if(g(c,"__lt")||g(c,"__lt"))return!!m.__call(h1,[c,d])[0];throw Error("attempt to compare "+
m.__type(c)+" with "+m.__type(d));};m.__le=function(c,d){var h=m.__type(c),k=m.__type(d);if("number"==h&&"number"==k||"string"==h&&"string"==k)return c<=d;if(h=g(c,"__le")||g(c,"__le"))return!!m.__call(h1,[c,d])[0];if(h=g(c,"__lt")||g(c,"__lt"))return!m.__call(h1,[c,d])[0];throw Error("attempt to compare "+m.__type(c)+" with "+m.__type(d));};m.__concat=function(c,d){var h=m.__type(c),k=m.__type(d);if(!("number"!=h&&"string"!=h||"number"!=k&&"string"!=k))return""+c+d||q;if(g(c,"__concat")||g(d,"__concat"))return m.__call(h1,
[c,d])[0];throw Error("attempt to concatenate a "+m.__type(c)+" value");};m.__newTable=function(c){return new l.LuaTable(c)};m.__len=function(c){switch(typeof c){case "string":return c.length}var d=g(c,"__len");if(d)return m.__call(d,[a])[0];if(c instanceof l.LuaTable)return c.length();throw Error("attempt to get length of a "+m.__type(a)+" value");};m.__tonumber=function(c){switch(typeof c){case "number":return c;case "string":return parseInt(s)||n;default:if(c==n)return c}return null};m.__checknumber=
function(c){switch(typeof c){case "number":return c;case "string":return parseInt(s)}if(c==n)return c;throw Error("Not a number.");};m.__tostring=function(c){if(null==c)return"nil";switch(typeof c){case "number":case "boolean":return c.toString();case "string":return c;case "function":return c._hashKey=c._hashKey||l.newHashKey(),"function("+c._hashKey+")";case "object":if(c==n)return"0";if(c==q)return q;var d=g(c,"__tostring");if(d)return m.__call(d,[c])[0];if(c.toString)return c.toString();default:return"userdata("+
c+")"}};m.__type=function(c){if(null==c)return"nil";var d=typeof c;switch(d){case "number":case "boolean":case "string":case "function":return d;case "object":if(c==n)return"number";if(c==q)return q;if(c instanceof l.LuaTable)return"table";default:return"userdata"}};m.__call=function(c,d){if("function"==typeof c)return c.__lua_function?c.apply(null,d):[c.apply(null,d)];var h=g(c,"__call");if(h)return d.unshift(h),m.__call(h,d);throw Error("attempt to call a "+m.__type(c)+" value");};m.__callMethod=
function(c,d,g){g.unshift(c);return m.__call(m.__get(c,d),g)};m.__dump=function(c){if("function"!=typeof c)throw Error("bad argument #1 to `dump` (function expected, got "+m.__type(c)+")");return h.sign+"return "+c.toString()+";"};this.loadString=m.__loadString=function(e,d){e=c(e);return(new Function("_ENV","l",e))(d||k,m)};this.loadStdLib=function(){if(!d.stdlib){var c=D("fs"),g=D("path"),c=c.readFileSync(g.join(g.dirname(module.filename),"./stdlib.lua"),{encoding:"utf-8"});d.stdlib=new Function("_ENV",
"l",d.compile(c))}d.stdlib(k,m)()}}var g=D("./parser.js");d.parser=g;var h=D("./codegen.js");d.codegen=h;var k=h.sign;d.compile=c;var l=D("./types.js");d.types=l;var n=l.dummy0,q=l.dummyStr;v.prototype={};d.LuaContext=d.newContext=v})(z.index);z.index.stdlib=function(d,c){return c._f(function(){Array.prototype.slice.call(arguments,0);c.__set(d,"assert",c._f(function(g,h){g||c.__call(c.__get(d,"error"),[h||"Assertion failed!"]);return[]}));c.__set(d,"collectgarbage",c._f(function(){return[]}));var v;
v=c._f(function(g){c.__call(c.__get(d,"error"),["Not implemented"]);return[]});c.__set(d,"dofile",v);c.__set(d,"error",function(c){throw Error(c);});c.__set(d,"getmetatable",function(c){return c&&c.metatable});c.__set(d,"ipairs",c._f(function(d){return[c._f(function(d,g){return c.__ge(g,c.__len(d))?[]:[c.__add(g,1),c.__get(d,c.__add(g,1))]}),d,c.d0]}));c.__set(d,"loadString",function(d,h){return c.__loadString(d,h)});c.__set(d,"load",c._f(function(g,h,k,l){if(c.__eq(c.__call(c.__get(d,"type"),[g])[0],
"function")){h=c.__newTable();for(g=[g];;){k=g[0](g[1],g[2])[0];if(null==k)break;g[2]=k;c.__call(c.__get(c.__get(d,"table"),"insert"),[c.__get(d,"chunk"),k])}g=c.__call(c.__get(c.__get(d,"table"),"concat"),[h])[0]}return c.__call(c.__get(d,"loadString"),[g,l])}));c.__set(d,"loadfile",v);c.__set(d,"next",v);c.__set(d,"pairs",v);c.__set(d,"pcall",c._f(function(d){var h=Array.prototype.slice.call(arguments,1);try{var k=c.__call(d,h);k.unshift(!0);return k}catch(l){return[!1,l]}}));c.__set(d,"print",
c._f(function(){for(var g=Array.prototype.slice.call(arguments,0),g=c.__newTable([[2,g]]),h,k=1,l=c.__checknumber(c.__len(g));(h=k)<=l;++k)c.__set(g,h,c.__call(c.__get(d,"tostring"),[c.__get(g,h)])[0]);c.__call(c.__get(c.__get(d,"io"),"write"),c.__call(c.__get(c.__get(d,"table"),"concat"),[g," "]));c.__call(c.__get(c.__get(d,"io"),"write"),["\n"]);return[]}));c.__set(d,"rawequal",function(c,d){return c===d});c.__set(d,"rawget",function(d,h){var k=c.__type(d);if("table"!=k)throw Error("rawget called with type "+
k);return d.get(h)});c.__set(d,"rawlen",function(d){var h=c.__type(d);if("table"!=h)throw Error("rawlen called with type "+h);return d.length()});c.__set(d,"rawset",function(d,h,k){var l=c.__type(d);if("table"!=l)throw Error("rawget called with type "+l);d.set(h,k);return d});c.__set(d,"select",function(c){return"#"==c?arguments.length:arguments[c]});c.__set(d,"setmetatable",function(c,d){if("object"!=typeof c)throw Error("Cannot set metatable to non-object values.");c.metatable=d});c.__set(d,"tonumber",
c.__tonumber);c.__set(d,"tostring",c.__tostring);c.__set(d,"type",c.__type);c.__set(d,"xpcall",function(d,h){var k=Array.prototype.slice.call(arguments,2);try{return c.__call(d,k)}catch(l){return c.__call(h,[l])}});c.__set(d,"package",c.__newTable());c.__set(c.__get(d,"package"),"loaded",c.__newTable());c.__set(c.__get(d,"package"),"preload",c.__newTable());c.__set(d,"require",c._f(function(g){var h=c.__get(c.__get(c.__get(d,"package"),"loaded"),g);if(h)return[h];for(var k,l,h=c.__call(c.__get(d,
"ipairs"),[c.__get(c.__get(d,"package"),"searchers")]);;){var n=h[0](h[1],h[2]),q=n[0],n=n[1];if(null==q)break;h[2]=q;n=c.__call(n,[g]);k=n[0];l=n[1];if(k)break}k=c.__call(k,[g,l])[0];c.__set(c.__get(c.__get(d,"package"),"loaded"),g,c.__get(c.__get(c.__get(d,"package"),"loaded"),g)||k);return[c.__get(c.__get(c.__get(d,"package"),"loaded"),g)]}));c.__set(d,"string",c.__newTable());c.stringMT=c.__get(d,"string");c.__set(c.__get(d,"string"),"byte",c._f(function(d,h,k){if("string"!=typeof d&&(d=c.__tostring(d),
d==c.ds))return[];h=h||1;k=k||h;0>h?h=d.length+h:h--;0>k&&(k=d.length+k+1);for(var l=[];h<k;++h){var n=d.charCodeAt(h);n&&l.push(n)}return l}));c.__set(c.__get(d,"string"),"dump",c.__dump);c.__set(c.__get(d,"string"),"find",function(c,d,k,l){if(l)return c.indexOf(d,k&&k-1)+1;throw Error("Not implemented.");});c.__set(c.__get(d,"string"),"len",function(d){"string"!=typeof d&&d!=c.ds&&(d=c.__tostring(d));return d==c.ds?0:d.length});c.__set(c.__get(d,"string"),"lower",function(d){"string"!=typeof d&&
d!=c.ds&&(d=c.__tostring(d));return d==c.ds?d:d.toLowerCase()});c.__set(c.__get(d,"string"),"upper",function(d){"string"!=typeof d&&d!=c.ds&&(d=c.__tostring(d));return d==c.ds?d:d.toUpperCase()});c.__set(c.__get(d,"string"),"rep",function(c,d,k){return k?Array(d).join(c+k)+c:Array(d+1).join(c)});c.__set(c.__get(d,"string"),"reverse",function(d){"string"!=typeof d&&d!=c.ds&&(d=c.__tostring(d));return d==c.ds?d:d.split("").reverse().join("")});c.__set(c.__get(d,"string"),"sub",function(d,h,k){"string"!=
typeof d&&d!=c.ds&&(d=c.__tostring(d));if(d==c.ds)return[d];k=k||d.length;0>h?h=d.length+h:h--;0>k&&(k=d.length+k+1);return d.substring(d,h,k)});c.__set(d,"table",c.__newTable());c.__set(c.__get(d,"table"),"concat",function(c,d,k,l){c=c.array;k&&(c=l?c.slice(k-1,l-1):c.slice(k-1));return c.join(d||"")});c.__set(c.__get(d,"table"),"insert",function(c,d,k){d?c.array.splice(d-1,0,k):c.array.push(k)});c.__set(c.__get(d,"table"),"pack",c._f(function(){var d=Array.prototype.slice.call(arguments,0);return[c.__newTable([[2,
d]])]}));c.__set(d,"pack",c.__get(c.__get(d,"table"),"pack"));c.__set(c.__get(d,"table"),"remove",c._f(function(c,d){return d?c.array.splice(d-1,1):[c.array.pop()]}));c.__set(c.__get(d,"table"),"sort",function(d,h){h?d.array.sort(function(){return h(a,b)[0]?-1:h(b,a)[0]?1:0}):d.array.sort(function(d,g){return c.__lt(d,g)?-1:c.__lt(g,d)?1:0})});c.__set(c.__get(d,"table"),"unpack",c._f(function(c){return c.array}));c.__set(d,"math",c.__newTable());c.__set(c.__get(d,"math"),"abs",Math.abs);c.__set(c.__get(d,
"math"),"acos",Math.acos);c.__set(c.__get(d,"math"),"asin",Math.asin);c.__set(c.__get(d,"math"),"atan",Math.atan);c.__set(c.__get(d,"math"),"atan2",Math.atan2);c.__set(c.__get(d,"math"),"ceil",Math.ceil);c.__set(c.__get(d,"math"),"cos",Math.cos);c.__set(c.__get(d,"math"),"cosh",Math.cosh);c.__set(c.__get(d,"math"),"deg",Math.deg);c.__set(c.__get(d,"math"),"exp",Math.exp);c.__set(c.__get(d,"math"),"floor",Math.floor);c.__set(c.__get(d,"math"),"pow",Math.pow);c.__set(c.__get(d,"math"),"sin",Math.sin);
c.__set(c.__get(d,"math"),"sinh",Math.sinh);c.__set(c.__get(d,"math"),"sqrt",Math.sqrt);c.__set(c.__get(d,"math"),"tan",Math.tan);c.__set(c.__get(d,"math"),"tanh",Math.tanh);c.__set(c.__get(d,"math"),"pi",Math.PI);c.__set(c.__get(d,"math"),"log",function(c,d){return d?Math.log(c)/Math.log(d):Math.log(c)});c.__set(c.__get(d,"math"),"max",function(){return Math.max.apply(null,arguments)});c.__set(c.__get(d,"math"),"min",function(c){return Math.min.apply(null,arguments)});c.__set(c.__get(d,"math"),"rad",
function(c){return[c*Math.PI/180]});c.__set(c.__get(d,"math"),"random",function(c,d){return c?d?[Math.floor(Math.random()*(d-c+1))+c]:[Math.floor(Math.random()*c)+1]:[Math.random()]});c.__set(d,"bit32",c.__newTable());c.__set(c.__get(d,"bit32"),"arshift",function(c,d){return c<<d});c.__set(c.__get(d,"bit32"),"band",function(c){for(var d=1;d<arguments.length;d++)c&=arguments[d];return c});c.__set(c.__get(d,"bit32"),"bnot",function(c){return~c});c.__set(c.__get(d,"bit32"),"bor",function(c){for(var d=
1;d<arguments.length;d++)c|=arguments[d];return c});c.__set(c.__get(d,"bit32"),"btest",function(c){for(var d=1;d<arguments.length;d++)c&=arguments[d];return 0!=c});c.__set(c.__get(d,"bit32"),"bxor",function(c){for(var d=1;d<arguments.length;d++)c^=arguments[d];return 0!=c});c.__set(d,"io",c.__newTable());c.__set(c.__get(d,"io"),"write",function(c){"\n"!=c&&console.log(c)});c.__set(c.__get(d,"io"),"flush",c._f(function(){return[]}));c.__set(d,"os",c.__newTable());c.__set(c.__get(d,"os"),"clock",function(){var c=
Date.now();return function(){return(Date.now()-c)/1E3}}());c.__set(c.__get(d,"os"),"difftime",c._f(function(d,h){return[c.__sub(d,h)]}));c.__set(c.__get(d,"os"),"time",function(){return Date.now()/1E3});return[]})};window.luajs=z.index;(function(){function d(c,d){var g=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");g.addEventListener("readystatechange",function(){if(4==g.readyState){if(200!=g.status&&0!=g.status)throw Error("HTTP "+g.status+": "+c);console.info("Loaded: ",
c);d(g.responseText)}});g.open("GET",c,!0);g.send()}function c(h,k){k=k||0;if(!(k>=h.length)){var l=h[k];l.code?(g.loadString(l.code)("embedded"),c(h,k+1)):d(l.src,function(d){g.loadString(d)(l.src);c(h,k+1)})}}function v(){for(var d=window.document.getElementsByTagName("script"),g=[],l=0;l<d.length;l++){var n=d[l];if("text/lua"==n.type||"application/x-lua"==n.type)n.src?g.push({src:n.src}):g.push({code:n.innerHTML})}c(g)}var g=luajs.newContext();g.loadStdLib();window.addEventListener?window.addEventListener("DOMContentLoaded",
v,!1):window.attachEvent("onload",v)})()})();
